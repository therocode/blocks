set( GIMGUI_FOUND false)

find_path(
    GIMGUI_INCLUDE_DIR
    gimgui/assert.hpp
    PATH_SUFFIXES
    include
    PATHS
    ${GIMGUI_ROOT}
    ${GIMGUIDIR}
    $ENV{GIMGUIDIR}
    $ENV{GIMGUI_ROOT}
    /usr
    /usr/local
    ~/Library/Frameworks
    /Library/Frameworks
    /sw
    /opt/local
    /opt/csw
    /opt
    "C:/Program Files (x86)"
    "C:/Program Files (x86)/gimgui"
)

set(FIND_GimGui_LIB_PATHS
    ${GIMGUI_ROOT}
    ${GIMGUIDIR}
    $ENV{GIMGUIDIR}
    $ENV{GIMGUI_ROOT}
    ~/Library/Frameworks
    /Library/Frameworks
    /usr/local
    /usr
    /sw
    /opt/local
    /opt/csw
    /opt
    "C:/Program Files (x86)"
    "C:/Program Files (x86)/gimgui"
)

#list(FIND GimGui_FIND_COMPONENTS "rendering" GimGui_NEEDS_GLM)

#if(GimGui_NEEDS_GLM EQUAL -1)
#    message("i don't need glm!")
#else()
#    message("i need glm!")
#endif()

set(GIMGUI_FOUND)
set(GIMGUI_LIBRARY)
set(GIMGUI_INCLUDE_DIR)

set(GIM_PRESERVE_LIBS false CACHE "" INTERNAL)

if(CMAKE_BUILD_TYPE MATCHES Debug)
    set(GIM_LIBRARY_SUFFIX "-d")
    set(GIM_LIBRARY_ANTISUFFIX "")
    set(BUILD_TYPE "debug")
    set(ANTI_BUILD_TYPE "release")
else()
    set(GIM_LIBRARY_SUFFIX "")
    set(GIM_LIBRARY_ANTISUFFIX "-d")
    set(BUILD_TYPE "release")
    set(ANTI_BUILD_TYPE "debug")
endif()

if(NOT (${GIM_LAST_MODE} MATCHES ${BUILD_TYPE}))
    unset(GIM_LAST_MODE CACHE)
    set(GIM_LAST_MODE ${BUILD_TYPE} CACHE "" INTERNAL)
    set(GIM_RESET_LIBS true)
else()
    set(GIM_RESET_LIBS false)
endif()

#foreach(FIND_GimGui_COMPONENT ${GimGui_FIND_COMPONENTS})
    #string(TOLOWER ${FIND_GimGui_COMPONENT} FIND_GimGui_COMPONENT)
    #set(GIMGUI_CURRENT_COMPONENT ${FIND_GimGui_COMPONENT}${GIM_LIBRARY_SUFFIX})

    set(FIND_GimGui_NAME gimgui)

    if(${GIM_RESET_LIBS})
        unset(GimGui_LIBRARY CACHE)
    endif()

    find_library(GimGui_LIBRARY
        NAMES ${FIND_GimGui_NAME}
        PATH_SUFFIXES lib64 lib
        PATHS ${FIND_GimGui_LIB_PATHS})
    #find_library(GimGui_${FIND_GimGui_COMPONENT}_LIBRARY
    #    NAMES ${FIND_GimGui_COMPONENT_NAME}
    #    PATH_SUFFIXES lib64 lib
    #    PATHS ${FIND_GimGui_LIB_PATHS})

    #second pass with anti suffix
    if(NOT GimGui_LIBRARY)
        #let the user know
        if(NOT GimGui_FIND_QUIETLY)
            message(WARNING "Failed to find ${BUILD_TYPE} version of GimGui. Will try to find ${ANTI_BUILD_TYPE} version instead.")
        endif()

        if(${GIM_RESET_LIBS})
            unset(GimGui_LIBRARY CACHE)
        endif()

        find_library(GimGui_LIBRARY
            NAMES ${FIND_GimGui_COMPONENT_NAME}${GIM_LIBRARY_ANTISUFFIX}
            PATH_SUFFIXES lib64 lib
            PATHS ${FIND_GimGui_LIB_PATHS})
    endif()

    if(NOT GimGui_LIBRARY)
        set(FIND_GimGui_MISSING "${FIND_GimGui_MISSING} GimGui_LIBRARY")
    else()
        set(GIMGUI_LIBRARY ${GIMGUI_LIBRARY} ${GimGui_LIBRARY})
    endif()
    #endforeach()

#foreach(FIND_GimGui_COMPONENT ${GimGui_FIND_COMPONENTS})
#    string(TOLOWER ${FIND_GimGui_COMPONENT} FIND_GimGui_COMPONENT)
#    set(GIMGUI_CURRENT_COMPONENT ${FIND_GimGui_COMPONENT}${GIM_LIBRARY_SUFFIX})
#
#    set(FIND_GimGui_COMPONENT_NAME gim-${GIMGUI_CURRENT_COMPONENT})
#
#    if(${GIM_RESET_LIBS})
#        unset(GimGui_${FIND_GimGui_COMPONENT}_LIBRARY CACHE)
#    endif()
#
#    find_library(GimGui_${FIND_GimGui_COMPONENT}_LIBRARY
#        NAMES ${FIND_GimGui_COMPONENT_NAME}
#        PATH_SUFFIXES lib64 lib
#        PATHS ${FIND_GimGui_LIB_PATHS})
#
#    #second pass with anti suffix
#    if(NOT GimGui_${FIND_GimGui_COMPONENT}_LIBRARY)
#        #let the user know
#        if(NOT GimGui_FIND_QUIETLY)
#            message(WARNING "Failed to find ${BUILD_TYPE} version of gim-${FIND_GimGui_COMPONENT}. Will try to find ${ANTI_BUILD_TYPE} version instead.")
#        endif()
#
#        set(GIMGUI_CURRENT_COMPONENT ${FIND_GimGui_COMPONENT}${GIM_LIBRARY_ANTISUFFIX})
#
#        set(FIND_GimGui_COMPONENT_NAME gim-${GIMGUI_CURRENT_COMPONENT})
#        
#        if(${GIM_RESET_LIBS})
#            unset(GimGui_${FIND_GimGui_COMPONENT}_LIBRARY CACHE)
#        endif()
#
#        find_library(GimGui_${FIND_GimGui_COMPONENT}_LIBRARY
#            NAMES ${FIND_GimGui_COMPONENT_NAME}
#            PATH_SUFFIXES lib64 lib
#            PATHS ${FIND_GimGui_LIB_PATHS})
#    endif()
#
#    if(NOT GimGui_${FIND_GimGui_COMPONENT}_LIBRARY)
#        set(FIND_GimGui_MISSING "${FIND_GimGui_MISSING} GimGui_${FIND_GimGui_COMPONENT}_LIBRARY")
#    else()
#        set(GIMGUI_LIBRARY ${GIMGUI_LIBRARY} ${GimGui_${FIND_GimGui_COMPONENT}_LIBRARY})
#    endif()
#endforeach()

find_library(
    GIMGUI_LIBRARY
    gim-ui
    PATH_SUFFIXES
    lib
    lib64
    PATHS
    /usr
    /usr/local
    ${GIMGUI_ROOT}
    ${GIMGUIDIR}
    $ENV{GIMGUIDIR}
    $ENV{GIMGUI_ROOT}
)

if(NOT GIMGUI_INCLUDE_DIR OR FIND_GimGui_MISSING)
    set(GIMGUI_FOUND)
    set(GIMGUI_INCLUDE_DIRS)
    set(GIMGUI_LIBRARIES)
    if(GimGui_FIND_REQUIRED)
        message(FATAL_ERROR "GimGui not found.")
    elseif(NOT GimGui_FIND_QUIETLY)
        message(STATUS "GimGui not found.")
    endif()
else()
    set(GIMGUI_FOUND true)
    if(NOT GimGui_FIND_QUIETLY)
        message(STATUS "GimGui found: ${GIMGUI_INCLUDE_DIR}")
    endif()
    set(GIMGUI_INCLUDE_DIRS ${GIMGUI_INCLUDE_DIR})
    set(GIMGUI_LIBRARIES ${GIMGUI_LIBRARY})
endif()
